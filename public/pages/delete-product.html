<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xóa sản phẩm</title>
    <link href="../styles/style.css" rel="stylesheet" type="text/css">
    <link href="../styles/delete-product.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="form-container">
        <div class="page-navigation">
            <a href="/" class="back-button">
                <span class="material-icons">arrow_back</span>
                Quay lại trang chủ
            </a>
        </div>
        
        <form id="deleteProductForm">
            <h1>Xóa sản phẩm</h1>
            <label for="productId">Chọn sản phẩm</label>
            <select id="productId" name="productId" required>
                <option value="" disabled selected>Chọn sản phẩm cần xóa</option>
            </select>
            <button type="submit">Xóa sản phẩm</button>
        </form>
    </div>
    <script>
        // Laden der Produkt-IDs in das Dropdown-Menü
        async function LoadProductIds() {
            try {
                const response = await fetch('/products');
                if (response.ok) {
                    const products = await response.json();
                    const productIdSelect = document.getElementById('productId');
                    products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.productId;
                        option.textContent = `${product.productId} - ${product.title}`;
                        productIdSelect.appendChild(option);
                    });
                } else {
                    console.error('Fehler beim Abrufen der Produktliste');
                }
            } catch (error) {
                console.error('Systemfehler:', error);
            }
        }

        // Laden der Produkt-IDs beim Laden der Seite
        document.addEventListener('DOMContentLoaded', LoadProductIds);

        // Event-Listener für das Formular
        document.getElementById('deleteProductForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const productId = document.getElementById('productId').value;

            if (!productId) {
                alert('Vui lòng chọn sản phẩm!');
                return;
            }

            try {
                const response = await fetch(`/delete/product/${productId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    const result = await response.json();
                    alert(result.message);
                    this.reset();

                    // Aktualisieren Sie die Dropdown-Liste nach dem Löschen
                    document.getElementById('productId').innerHTML = '<option value="" disabled selected>Chọn sản phẩm cần xóa</option>';
                    LoadProductIds();
                } else {
                    const error = await response.json();
                    alert(error.error || 'Đã xảy ra lỗi khi xóa sản phẩm');
                }
            } catch (err) {
                console.error('Lỗi hệ thống:', err);
                alert('Đã xảy ra lỗi hệ thống');
            }
        });
    </script>    
</body>
</html>
